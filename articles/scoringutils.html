<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>scoringutils • scoringutils</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="scoringutils">
<meta property="og:description" content="scoringutils">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">scoringutils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/scoringutils.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/epiforecasts/scoringutils/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="scoringutils_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>scoringutils</h1>
                        <h4 class="author">Nikos Bosse</h4>
            
            <h4 class="date">2021-02-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/epiforecasts/scoringutils/blob/master/vignettes/scoringutils.Rmd"><code>vignettes/scoringutils.Rmd</code></a></small>
      <div class="hidden name"><code>scoringutils.Rmd</code></div>

    </div>

    
    
<div id="introduction-and-overview-of-functionality" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction-and-overview-of-functionality" class="anchor"></a>Introduction and Overview of Functionality</h1>
<p>The <code>scoringutils</code> package provides a collection of metrics and proper scoring rules that make it simple to score forecasts against the true observed values. Predictions can either be automatically scored from a <code>data.frame</code> using the function <code>eval_forecasts</code>. Alternatively, evaluation metrics can be accessed directly using lower level functions within a vector/matrix framework.</p>
<p>Predictions can be handled in various formats: <code>scoringutils</code> can handle probabilistic forecasts in either a sample based or a quantile based format. For more detail on the expected input formats please see below. True values can be integer, continuous or binary.</p>
<p>In addition to automatic scoring, <code>scoringutils</code> offers a variety of plots and visualisations.</p>
</div>
<div id="scoring-forecasts-automatically" class="section level1">
<h1 class="hasAnchor">
<a href="#scoring-forecasts-automatically" class="anchor"></a>Scoring Forecasts Automatically</h1>
<p>Most of the time, the <code>eval_forecasts</code> function will be able to do the entire evaluation for you. The idea is simple, yet flexible.</p>
<p>All you need to do is to pass in a <code>data.frame</code> that has a column called <code>prediction</code> and one called <code>true_value</code>. Depending on the exact input format, additional columns like <code>sample</code>, <code>quantile</code> or <code>range</code> and <code>boundary</code> are needed. Additional columns may be present to indicate a grouping of forecasts. For example, we could have forecasts made by different models in various locations at different time points, each for several weeks into the future. In this case, we would have additional columns called for example <code>model</code>, <code>date</code>, <code>forecast_date</code>, <code>forecast_horizon</code> and <code>location</code>.</p>
<p>Using the <code>by</code> argument you need to specify the <em>unit of a single forecast</em>. In this example here we would set <code>by = c("model", "date", "forecast_date", "forecast_horizon", "location")</code> (note: if we want to be pedantic, there is a small duplication as the information of “date” is already included in the combination of “forecast_date” and “forecast_horizon”. But as long as there isn’t some weird shift, this doesn’t matter for the purpose of grouping our observations). If you don’t specify <code>by</code> (i.e. <code>by = NULL</code>), <code>scoringutils</code> will automatically use all appropriate present columns. Note that you don’t need to include columns such as <code>quantile</code> or <code>sample</code> in the <code>by</code> argument, as several quantiles / samples make up one forecast.</p>
<p>Using the <code>summarise_by</code> argument you can now choose categories to aggregate over. If you were only interested in scores for the different models, you would specify <code>summarise_by = c("model")</code>. If you wanted to have scores for every model in every location, you would need to specify <code>summarise_by = c("model", "location")</code>. If you wanted to have one score per quantile or one per prediction interval range, you could specify something like <code>summarise_by = c("model", "quantile")</code> or <code>summarise_by = c("model", "quantile", "range")</code> (note again that some information is duplicated in quantile and range, but this doesn’t really matter for grouping purposes). When aggregating, <code>eval_forecasts</code> takes the mean according to the group defined in <code>summarise_by</code> (i.e. in this example, if <code>summarise_by = c("model", "location")</code>, scores will be averaged over all forecast dates, forecast horizons and quantiles to yield one score per model and location). In addition to the mean, you can also obtain the standard deviation of the scores over which you average or any desired quantile (e.g. the median in addition to the mean) by specifying <code>sd = TRUE</code> and <code>quantiles = c(0.5)</code>.</p>
<div id="example-evaluation" class="section level2">
<h2 class="hasAnchor">
<a href="#example-evaluation" class="anchor"></a>Example Evaluation</h2>
<p>Here is an example of an evaluation using the example data included in the package. The data comes from a set of <a href="https://github.com/epiforecasts/covid19.forecasts.uk">Covid-19 short-term forecasts in the UK</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/epiforecasts/scoringutils">scoringutils</a></span><span class="op">)</span>
<span class="co">#&gt; Note: The definition of the weighted interval score has slightly changed in version 0.1.5. If you want to use the old definition, use the argument `count_median_twice = TRUE` in the function `eval_forecasts()`</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://Rdatatable.gitlab.io/data.table">data.table</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">scoringutils</span><span class="fu">::</span><span class="va"><a href="../reference/quantile_example_data.html">quantile_example_data</a></span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">data</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt;       value_date     value_type geography          value_desc true_value</span>
<span class="co">#&gt;    1: 2020-05-04   hospital_inc   England Hospital admissions       1043</span>
<span class="co">#&gt;    2: 2020-05-04  hospital_prev   England Total beds occupied      10648</span>
<span class="co">#&gt;    3: 2020-05-11   hospital_inc   England Hospital admissions        743</span>
<span class="co">#&gt;   ---                                                                   </span>
<span class="co">#&gt; 5150: 2020-08-03 death_inc_line     Wales              Deaths          1</span>
<span class="co">#&gt; 5151: 2020-08-03 death_inc_line     Wales              Deaths          1</span>
<span class="co">#&gt; 5152: 2020-08-03 death_inc_line     Wales              Deaths          1</span>
<span class="co">#&gt;                    model creation_date quantile prediction horizon</span>
<span class="co">#&gt;    1:               &lt;NA&gt;          &lt;NA&gt;       NA         NA      NA</span>
<span class="co">#&gt;    2:               &lt;NA&gt;          &lt;NA&gt;       NA         NA      NA</span>
<span class="co">#&gt;    3:               &lt;NA&gt;          &lt;NA&gt;       NA         NA      NA</span>
<span class="co">#&gt;   ---                                                             </span>
<span class="co">#&gt; 5150:           SIRCOVID    2020-07-13     0.85          4      21</span>
<span class="co">#&gt; 5151: DetSEIRwithNB MCMC    2020-07-13     0.90          2      21</span>
<span class="co">#&gt; 5152:           SIRCOVID    2020-07-13     0.90          6      21</span>

<span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu">scoringutils</span><span class="fu">::</span><span class="fu"><a href="../reference/eval_forecasts.html">eval_forecasts</a></span><span class="op">(</span><span class="va">data</span>, 
                                       summarise_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"model"</span>, <span class="st">"quantile"</span>, <span class="st">"range"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">scores</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt;                  model quantile range interval_score sharpness underprediction</span>
<span class="co">#&gt;  1: DetSEIRwithNB MCMC     0.50     0       54.45528  0.000000     54.16260163</span>
<span class="co">#&gt;  2: DetSEIRwithNB MCMC     0.45    10       53.96138  6.310976     47.42276423</span>
<span class="co">#&gt;  3: DetSEIRwithNB MCMC     0.55    10       53.96138  6.310976     47.42276423</span>
<span class="co">#&gt; ---                                                                           </span>
<span class="co">#&gt; 55:           SIRCOVID     0.90    80       18.18000 17.368889      0.15555556</span>
<span class="co">#&gt; 56:           SIRCOVID     0.05    90       11.69444 11.661111      0.03333333</span>
<span class="co">#&gt; 57:           SIRCOVID     0.95    90       11.69444 11.661111      0.03333333</span>
<span class="co">#&gt;     overprediction  coverage coverage_deviation       bias      aem</span>
<span class="co">#&gt;  1:      0.2926829 0.3170732         0.31707317 -0.2333333 54.45528</span>
<span class="co">#&gt;  2:      0.2276423 0.4308943         0.33089431 -0.2333333 54.45528</span>
<span class="co">#&gt;  3:      0.2276423 0.4308943         0.33089431 -0.2333333 54.45528</span>
<span class="co">#&gt; ---                                                                </span>
<span class="co">#&gt; 55:      0.6555556 0.9333333         0.13333333  0.2255556 42.90000</span>
<span class="co">#&gt; 56:      0.0000000 0.9888889         0.08888889  0.2255556 42.90000</span>
<span class="co">#&gt; 57:      0.0000000 0.9888889         0.08888889  0.2255556 42.90000</span>
<span class="co">#&gt;     quantile_coverage relative_skill scaled_rel_skill</span>
<span class="co">#&gt;  1:         0.4959350      1.2309038              NaN</span>
<span class="co">#&gt;  2:         0.4308943      1.2309038              NaN</span>
<span class="co">#&gt;  3:         0.5691057      1.2309038              NaN</span>
<span class="co">#&gt; ---                                                  </span>
<span class="co">#&gt; 55:         0.9777778      0.6704351              NaN</span>
<span class="co">#&gt; 56:         0.2666667      0.6704351              NaN</span>
<span class="co">#&gt; 57:         0.9888889      0.6704351              NaN</span></code></pre></div>
<p>Using an appropriate level of summary, we can easily use the output for visualisation. The <code>scoringutils</code> package offers some built-in functions to help get a sense of the data</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">filtered_data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">geography</span> <span class="op">==</span> <span class="st">"England"</span> <span class="op">&amp;</span> 
                        <span class="va">creation_date</span> <span class="op">&lt;=</span> <span class="st">"2020-06-29"</span> <span class="op">&amp;</span> 
                        <span class="va">value_desc</span> <span class="op">==</span> <span class="st">"Deaths"</span><span class="op">]</span>

<span class="fu">scoringutils</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_predictions.html">plot_predictions</a></span><span class="op">(</span><span class="va">filtered_data</span><span class="op">[</span><span class="va">creation_date</span> <span class="op">==</span> <span class="st">"2020-06-29"</span><span class="op">]</span>, 
                               add_truth_data <span class="op">=</span> <span class="va">filtered_data</span>,
                               x <span class="op">=</span> <span class="st">"value_date"</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">90</span><span class="op">)</span>, 
                               facet_formula <span class="op">=</span> <span class="va">value_desc</span> <span class="op">~</span> <span class="va">model</span><span class="op">)</span></code></pre></div>
<p><img src="scoringutils_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<p>(The data is just randomly generated values. We plan to add real example data to make these illustrations more useful in the future)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu">scoringutils</span><span class="fu">::</span><span class="fu"><a href="../reference/eval_forecasts.html">eval_forecasts</a></span><span class="op">(</span><span class="va">data</span>, 
                             summarise_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"model"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">scoringutils</span><span class="fu">::</span><span class="fu"><a href="../reference/score_table.html">score_table</a></span><span class="op">(</span><span class="va">scores</span><span class="op">)</span></code></pre></div>
<p><img src="scoringutils_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<p>Given this level of aggregation, not all metrics may make sense. In this case, for example, averaging over different quantiles to compute quantile coverage does not make much sense. If you like, you can select specific metrics for the visualisation.</p>
<p>Let us look at calibration:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu">scoringutils</span><span class="fu">::</span><span class="fu"><a href="../reference/eval_forecasts.html">eval_forecasts</a></span><span class="op">(</span><span class="va">data</span>, 
                             summarise_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"model"</span>, <span class="st">"range"</span>, <span class="st">"quantile"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">scoringutils</span><span class="fu">::</span><span class="fu"><a href="../reference/interval_coverage.html">interval_coverage</a></span><span class="op">(</span><span class="va">scores</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Interval Coverage"</span><span class="op">)</span>

<span class="fu">scoringutils</span><span class="fu">::</span><span class="fu"><a href="../reference/quantile_coverage.html">quantile_coverage</a></span><span class="op">(</span><span class="va">scores</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Quantile Coverage"</span><span class="op">)</span></code></pre></div>
<p><img src="scoringutils_files/figure-html/unnamed-chunk-6-1.png" width="50%"><img src="scoringutils_files/figure-html/unnamed-chunk-6-2.png" width="50%"></p>
<p>Let us look at the individual components of the weighted interval score:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu">scoringutils</span><span class="fu">::</span><span class="fu"><a href="../reference/eval_forecasts.html">eval_forecasts</a></span><span class="op">(</span><span class="va">data</span>, 
                             summarise_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"model"</span>, <span class="st">"value_desc"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning in sort(summarise_by) == sort(by): longer object length is not a</span>
<span class="co">#&gt; multiple of shorter object length</span>
<span class="fu">scoringutils</span><span class="fu">::</span><span class="fu"><a href="../reference/wis_components.html">wis_components</a></span><span class="op">(</span><span class="va">scores</span>, facet_formula <span class="op">=</span> <span class="op">~</span> <span class="va">value_desc</span><span class="op">)</span></code></pre></div>
<p><img src="scoringutils_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>We can also look at contributions to different metrics by range:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu">scoringutils</span><span class="fu">::</span><span class="fu"><a href="../reference/eval_forecasts.html">eval_forecasts</a></span><span class="op">(</span><span class="va">data</span>, 
                             summarise_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"model"</span>, <span class="st">"range"</span>, <span class="st">"value_desc"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning in sort(summarise_by) == sort(by): longer object length is not a</span>
<span class="co">#&gt; multiple of shorter object length</span>
<span class="fu">scoringutils</span><span class="fu">::</span><span class="fu"><a href="../reference/range_plot.html">range_plot</a></span><span class="op">(</span><span class="va">scores</span>, y <span class="op">=</span> <span class="st">"interval_score"</span>, 
                         facet_formula <span class="op">=</span> <span class="op">~</span> <span class="va">value_desc</span><span class="op">)</span></code></pre></div>
<p><img src="scoringutils_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>We can also visualise metrics using a heatmap:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu">scoringutils</span><span class="fu">::</span><span class="fu"><a href="../reference/eval_forecasts.html">eval_forecasts</a></span><span class="op">(</span><span class="va">data</span>, 
                             summarise_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"model"</span>, <span class="st">"horizon"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning in sort(summarise_by) == sort(by): longer object length is not a</span>
<span class="co">#&gt; multiple of shorter object length</span>
<span class="co">#&gt; Warning in wilcox.test.default(values_x, values_y, paired = TRUE): cannot</span>
<span class="co">#&gt; compute exact p-value with ties</span>
<span class="va">scores</span> <span class="op">&lt;-</span> <span class="va">scores</span><span class="op">[</span>, <span class="va">horizon</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">horizon</span><span class="op">)</span><span class="op">]</span>
<span class="fu">scoringutils</span><span class="fu">::</span><span class="fu"><a href="../reference/score_heatmap.html">score_heatmap</a></span><span class="op">(</span><span class="va">scores</span>, 
                            x <span class="op">=</span> <span class="st">"horizon"</span>, metric <span class="op">=</span> <span class="st">"bias"</span><span class="op">)</span></code></pre></div>
<div id="expected-input-formats" class="section level3">
<h3 class="hasAnchor">
<a href="#expected-input-formats" class="anchor"></a>Expected Input Formats</h3>
<p>The <code>eval_forecasts</code> function is designed to work with various different input formats. The following formats are currently supported:</p>
<p>quantile forecasts in either a plain quantile format or in a format that specifies interval ranges and the boundary of a given interval range.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">scoringutils</span><span class="fu">::</span><span class="va"><a href="../reference/quantile_example_data.html">quantile_example_data</a></span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt;       value_date     value_type geography          value_desc true_value</span>
<span class="co">#&gt;    1: 2020-05-04   hospital_inc   England Hospital admissions       1043</span>
<span class="co">#&gt;    2: 2020-05-04  hospital_prev   England Total beds occupied      10648</span>
<span class="co">#&gt;    3: 2020-05-11   hospital_inc   England Hospital admissions        743</span>
<span class="co">#&gt;   ---                                                                   </span>
<span class="co">#&gt; 5150: 2020-08-03 death_inc_line     Wales              Deaths          1</span>
<span class="co">#&gt; 5151: 2020-08-03 death_inc_line     Wales              Deaths          1</span>
<span class="co">#&gt; 5152: 2020-08-03 death_inc_line     Wales              Deaths          1</span>
<span class="co">#&gt;                    model creation_date quantile prediction horizon</span>
<span class="co">#&gt;    1:               &lt;NA&gt;          &lt;NA&gt;       NA         NA      NA</span>
<span class="co">#&gt;    2:               &lt;NA&gt;          &lt;NA&gt;       NA         NA      NA</span>
<span class="co">#&gt;    3:               &lt;NA&gt;          &lt;NA&gt;       NA         NA      NA</span>
<span class="co">#&gt;   ---                                                             </span>
<span class="co">#&gt; 5150:           SIRCOVID    2020-07-13     0.85          4      21</span>
<span class="co">#&gt; 5151: DetSEIRwithNB MCMC    2020-07-13     0.90          2      21</span>
<span class="co">#&gt; 5152:           SIRCOVID    2020-07-13     0.90          6      21</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">scoringutils</span><span class="fu">::</span><span class="va"><a href="../reference/range_example_data_long.html">range_example_data_long</a></span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt;       value_date     value_type geography          value_desc true_value</span>
<span class="co">#&gt;    1: 2020-05-04   hospital_inc   England Hospital admissions       1043</span>
<span class="co">#&gt;    2: 2020-05-04  hospital_prev   England Total beds occupied      10648</span>
<span class="co">#&gt;    3: 2020-05-11   hospital_inc   England Hospital admissions        743</span>
<span class="co">#&gt;   ---                                                                   </span>
<span class="co">#&gt; 5417: 2020-07-27 death_inc_line     Wales              Deaths          1</span>
<span class="co">#&gt; 5418: 2020-08-03 death_inc_line     Wales              Deaths          1</span>
<span class="co">#&gt; 5419: 2020-08-03 death_inc_line     Wales              Deaths          1</span>
<span class="co">#&gt;                    model creation_date prediction horizon boundary range</span>
<span class="co">#&gt;    1:               &lt;NA&gt;          &lt;NA&gt;         NA      NA     &lt;NA&gt;    NA</span>
<span class="co">#&gt;    2:               &lt;NA&gt;          &lt;NA&gt;         NA      NA     &lt;NA&gt;    NA</span>
<span class="co">#&gt;    3:               &lt;NA&gt;          &lt;NA&gt;         NA      NA     &lt;NA&gt;    NA</span>
<span class="co">#&gt;   ---                                                                   </span>
<span class="co">#&gt; 5417:           SIRCOVID    2020-07-13          1      14    upper     0</span>
<span class="co">#&gt; 5418: DetSEIRwithNB MCMC    2020-07-13          0      21    upper     0</span>
<span class="co">#&gt; 5419:           SIRCOVID    2020-07-13          1      21    upper     0</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">scoringutils</span><span class="fu">::</span><span class="va"><a href="../reference/range_example_data_wide.html">range_example_data_wide</a></span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt;      value_date     value_type        geography          value_desc true_value</span>
<span class="co">#&gt;   1: 2020-05-04 death_inc_line          England              Deaths        448</span>
<span class="co">#&gt;   2: 2020-05-04 death_inc_line Northern Ireland              Deaths          9</span>
<span class="co">#&gt;   3: 2020-05-04 death_inc_line         Scotland              Deaths         40</span>
<span class="co">#&gt;  ---                                                                          </span>
<span class="co">#&gt; 344: 2020-08-03  hospital_prev          England Total beds occupied        784</span>
<span class="co">#&gt; 345: 2020-08-03  hospital_prev         Scotland Total beds occupied        265</span>
<span class="co">#&gt; 346: 2020-08-03       icu_prev         Scotland   ICU beds occupied          3</span>
<span class="co">#&gt;                   model creation_date horizon lower_0 lower_10 lower_20</span>
<span class="co">#&gt;   1:               &lt;NA&gt;          &lt;NA&gt;      NA      NA       NA       NA</span>
<span class="co">#&gt;   2:               &lt;NA&gt;          &lt;NA&gt;      NA      NA       NA       NA</span>
<span class="co">#&gt;   3:               &lt;NA&gt;          &lt;NA&gt;      NA      NA       NA       NA</span>
<span class="co">#&gt;  ---                                                                   </span>
<span class="co">#&gt; 344:               &lt;NA&gt;          &lt;NA&gt;      NA      NA       NA       NA</span>
<span class="co">#&gt; 345:               &lt;NA&gt;          &lt;NA&gt;      NA      NA       NA       NA</span>
<span class="co">#&gt; 346: DetSEIRwithNB MCMC    2020-07-13      21       2        2        2</span>
<span class="co">#&gt;      lower_30 lower_40 lower_50 lower_60 lower_70 lower_80 lower_90 upper_0</span>
<span class="co">#&gt;   1:       NA       NA       NA       NA       NA       NA       NA      NA</span>
<span class="co">#&gt;   2:       NA       NA       NA       NA       NA       NA       NA      NA</span>
<span class="co">#&gt;   3:       NA       NA       NA       NA       NA       NA       NA      NA</span>
<span class="co">#&gt;  ---                                                                       </span>
<span class="co">#&gt; 344:       NA       NA       NA       NA       NA       NA       NA      NA</span>
<span class="co">#&gt; 345:       NA       NA       NA       NA       NA       NA       NA      NA</span>
<span class="co">#&gt; 346:        2        2        1        1        1        1        0       2</span>
<span class="co">#&gt;      upper_10 upper_20 upper_30 upper_40 upper_50 upper_60 upper_70 upper_80</span>
<span class="co">#&gt;   1:       NA       NA       NA       NA       NA       NA       NA       NA</span>
<span class="co">#&gt;   2:       NA       NA       NA       NA       NA       NA       NA       NA</span>
<span class="co">#&gt;   3:       NA       NA       NA       NA       NA       NA       NA       NA</span>
<span class="co">#&gt;  ---                                                                        </span>
<span class="co">#&gt; 344:       NA       NA       NA       NA       NA       NA       NA       NA</span>
<span class="co">#&gt; 345:       NA       NA       NA       NA       NA       NA       NA       NA</span>
<span class="co">#&gt; 346:        3        3        3        3        4        4        4        5</span>
<span class="co">#&gt;      upper_90</span>
<span class="co">#&gt;   1:       NA</span>
<span class="co">#&gt;   2:       NA</span>
<span class="co">#&gt;   3:       NA</span>
<span class="co">#&gt;  ---         </span>
<span class="co">#&gt; 344:       NA</span>
<span class="co">#&gt; 345:       NA</span>
<span class="co">#&gt; 346:        6</span></code></pre></div>
<p>sample based format with either continuous or integer values</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">scoringutils</span><span class="fu">::</span><span class="va"><a href="../reference/integer_example_data.html">integer_example_data</a></span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt;        value_date     value_type geography          value_desc    model</span>
<span class="co">#&gt;     1: 2020-05-04   hospital_inc   England Hospital admissions     &lt;NA&gt;</span>
<span class="co">#&gt;     2: 2020-05-04  hospital_prev   England Total beds occupied     &lt;NA&gt;</span>
<span class="co">#&gt;     3: 2020-05-11   hospital_inc   England Hospital admissions     &lt;NA&gt;</span>
<span class="co">#&gt;    ---                                                                 </span>
<span class="co">#&gt; 13427: 2020-08-03 death_inc_line     Wales              Deaths SIRCOVID</span>
<span class="co">#&gt; 13428: 2020-08-03 death_inc_line     Wales              Deaths SIRCOVID</span>
<span class="co">#&gt; 13429: 2020-08-03 death_inc_line     Wales              Deaths SIRCOVID</span>
<span class="co">#&gt;        creation_date horizon prediction sample true_value</span>
<span class="co">#&gt;     1:          &lt;NA&gt;      NA         NA     NA       1043</span>
<span class="co">#&gt;     2:          &lt;NA&gt;      NA         NA     NA      10648</span>
<span class="co">#&gt;     3:          &lt;NA&gt;      NA         NA     NA        743</span>
<span class="co">#&gt;    ---                                                   </span>
<span class="co">#&gt; 13427:    2020-07-13      21          0     48          1</span>
<span class="co">#&gt; 13428:    2020-07-13      21          0     49          1</span>
<span class="co">#&gt; 13429:    2020-07-13      21          0     50          1</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">scoringutils</span><span class="fu">::</span><span class="va"><a href="../reference/continuous_example_data.html">continuous_example_data</a></span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt;        value_date     value_type geography          value_desc    model</span>
<span class="co">#&gt;     1: 2020-05-04   hospital_inc   England Hospital admissions     &lt;NA&gt;</span>
<span class="co">#&gt;     2: 2020-05-04  hospital_prev   England Total beds occupied     &lt;NA&gt;</span>
<span class="co">#&gt;     3: 2020-05-11   hospital_inc   England Hospital admissions     &lt;NA&gt;</span>
<span class="co">#&gt;    ---                                                                 </span>
<span class="co">#&gt; 13427: 2020-08-03 death_inc_line     Wales              Deaths SIRCOVID</span>
<span class="co">#&gt; 13428: 2020-08-03 death_inc_line     Wales              Deaths SIRCOVID</span>
<span class="co">#&gt; 13429: 2020-08-03 death_inc_line     Wales              Deaths SIRCOVID</span>
<span class="co">#&gt;        creation_date horizon   prediction sample true_value</span>
<span class="co">#&gt;     1:          &lt;NA&gt;      NA           NA     NA       1043</span>
<span class="co">#&gt;     2:          &lt;NA&gt;      NA           NA     NA      10648</span>
<span class="co">#&gt;     3:          &lt;NA&gt;      NA           NA     NA        743</span>
<span class="co">#&gt;    ---                                                     </span>
<span class="co">#&gt; 13427:    2020-07-13      21 0.3340917507     48          1</span>
<span class="co">#&gt; 13428:    2020-07-13      21 0.3540187438     49          1</span>
<span class="co">#&gt; 13429:    2020-07-13      21 0.0001998965     50          1</span></code></pre></div>
<p>forecasts in a binary format:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">scoringutils</span><span class="fu">::</span><span class="va"><a href="../reference/binary_example_data.html">binary_example_data</a></span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt;      value_date     value_type geography          value_desc              model</span>
<span class="co">#&gt;   1: 2020-05-04   hospital_inc   England Hospital admissions               &lt;NA&gt;</span>
<span class="co">#&gt;   2: 2020-05-04  hospital_prev   England Total beds occupied               &lt;NA&gt;</span>
<span class="co">#&gt;   3: 2020-05-11   hospital_inc   England Hospital admissions               &lt;NA&gt;</span>
<span class="co">#&gt;  ---                                                                           </span>
<span class="co">#&gt; 344: 2020-07-27 death_inc_line     Wales              Deaths           SIRCOVID</span>
<span class="co">#&gt; 345: 2020-08-03 death_inc_line     Wales              Deaths DetSEIRwithNB MCMC</span>
<span class="co">#&gt; 346: 2020-08-03 death_inc_line     Wales              Deaths           SIRCOVID</span>
<span class="co">#&gt;      creation_date horizon prediction true_value</span>
<span class="co">#&gt;   1:          &lt;NA&gt;      NA         NA         NA</span>
<span class="co">#&gt;   2:          &lt;NA&gt;      NA         NA         NA</span>
<span class="co">#&gt;   3:          &lt;NA&gt;      NA         NA         NA</span>
<span class="co">#&gt;  ---                                            </span>
<span class="co">#&gt; 344:    2020-07-13      14       0.34          0</span>
<span class="co">#&gt; 345:    2020-07-13      21       0.22          1</span>
<span class="co">#&gt; 346:    2020-07-13      21       0.26          0</span></code></pre></div>
<p>It also offers functionality to convert between these formats. For more information have a look at the documentation of the following functions:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">scoringutils</span><span class="fu">::</span><span class="fu"><a href="../reference/sample_to_quantile.html">sample_to_quantile</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># convert from sample based to quantile format</span>
<span class="fu">scoringutils</span><span class="fu">::</span><span class="fu"><a href="../reference/range_long_to_quantile.html">range_long_to_quantile</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># convert from range format to plain quantile</span>
<span class="fu">scoringutils</span><span class="fu">::</span><span class="fu"><a href="../reference/quantile_to_range_long.html">quantile_to_range_long</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># convert the other way round</span>
<span class="fu">scoringutils</span><span class="fu">::</span><span class="fu"><a href="../reference/range_wide_to_long.html">range_wide_to_long</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># convert range based format from wide to long</span>
<span class="fu">scoringutils</span><span class="fu">::</span><span class="fu"><a href="../reference/range_long_to_wide.html">range_long_to_wide</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># convert the other way round</span></code></pre></div>
</div>
</div>
</div>
<div id="scoring-forecasts-directly" class="section level1">
<h1 class="hasAnchor">
<a href="#scoring-forecasts-directly" class="anchor"></a>Scoring Forecasts Directly</h1>
<p>A variety of metrics and scoring rules can also be accessed directly through the <code>scoringutils</code> package.</p>
<p>The following gives an overview of (most of) the implemented metrics.</p>
<div id="bias" class="section level2">
<h2 class="hasAnchor">
<a href="#bias" class="anchor"></a>Bias</h2>
<p>The function <code>bias</code> determines bias from predictive Monte-Carlo samples, automatically recognising whether forecasts are continuous or integer valued.</p>
<p>For continuous forecasts, Bias is measured as <span class="math display">\[B_t (P_t, x_t) = 1 - 2 \cdot (P_t (x_t))\]</span></p>
<p>where <span class="math inline">\(P_t\)</span> is the empirical cumulative distribution function of the prediction for the true value <span class="math inline">\(x_t\)</span>. Computationally, <span class="math inline">\(P_t (x_t)\)</span> is just calculated as the fraction of predictive samples for <span class="math inline">\(x_t\)</span> that are smaller than <span class="math inline">\(x_t\)</span>.</p>
<p>For integer valued forecasts, Bias is measured as</p>
<p><span class="math display">\[B_t (P_t, x_t) = 1 - (P_t (x_t) + P_t (x_t + 1))\]</span></p>
<p>to adjust for the integer nature of the forecasts. In both cases, Bias can assume values between -1 and 1 and is 0 ideally.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## integer valued forecasts</span>
<span class="va">true_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="fl">30</span>, lambda <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span>
<span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">30</span>, lambda <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/bias.html">bias</a></span><span class="op">(</span><span class="va">true_values</span>, <span class="va">predictions</span><span class="op">)</span>
<span class="co">#&gt;  [1] -1.000 -0.060 -0.175  0.685 -0.365  0.495  0.785  0.405  0.510  0.640</span>
<span class="co">#&gt; [11] -0.060 -0.265 -0.400  0.825  0.915  0.305 -0.435  0.905 -0.245 -0.965</span>
<span class="co">#&gt; [21] -0.770  0.620 -0.545  0.980  0.300 -0.925 -0.610 -0.870  0.425 -0.190</span>

<span class="co">## continuous forecasts</span>
<span class="va">true_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">30</span>, mean <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span>
<span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">30</span>, mean <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/bias.html">bias</a></span><span class="op">(</span><span class="va">true_values</span>, <span class="va">predictions</span><span class="op">)</span>
<span class="co">#&gt;  [1] -0.14  0.35 -0.19 -0.86  0.27 -0.63 -0.86  0.58  0.13  0.32  0.45  0.91</span>
<span class="co">#&gt; [13] -0.73  0.40  0.52  0.74  0.27  0.53 -0.63  0.63 -0.60 -0.34  0.07 -0.20</span>
<span class="co">#&gt; [25] -0.37 -0.42  0.27  0.06  0.57 -0.85</span></code></pre></div>
</div>
<div id="sharpness" class="section level2">
<h2 class="hasAnchor">
<a href="#sharpness" class="anchor"></a>Sharpness</h2>
<p>Sharpness is the ability of the model to generate predictions within a narrow range. It is a data-independent measure, and is purely a feature of the forecasts themselves.</p>
<p>Shaprness of predictive samples corresponding to one single true value is measured as the normalised median of the absolute deviation from the median of the predictive samples. For details, see <code><a href="https://rdrr.io/r/stats/mad.html">?stats::mad</a></code></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">30</span>, lambda <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/sharpness.html">sharpness</a></span><span class="op">(</span><span class="va">predictions</span><span class="op">)</span>
<span class="co">#&gt;  [1] 1.4826 1.4826 1.4826 1.4826 2.9652 2.9652 2.9652 2.9652 3.7065 3.7065</span>
<span class="co">#&gt; [11] 2.9652 2.9652 4.4478 4.4478 4.4478 4.4478 3.7065 4.4478 4.4478 4.4478</span>
<span class="co">#&gt; [21] 4.4478 4.4478 4.4478 4.4478 4.4478 4.4478 5.9304 5.9304 4.4478 6.6717</span></code></pre></div>
</div>
<div id="calibration" class="section level2">
<h2 class="hasAnchor">
<a href="#calibration" class="anchor"></a>Calibration</h2>
<p>Calibration or reliability of forecasts is the ability of a model to correctly identify its own uncertainty in making predictions. In a model with perfect calibration, the observed data at each time point look as if they came from the predictive probability distribution at that time.</p>
<p>Equivalently, one can inspect the probability integral transform of the predictive distribution at time t,</p>
<p><span class="math display">\[u_t = F_t (x_t)\]</span></p>
<p>where <span class="math inline">\(x_t\)</span> is the observed data point at time <span class="math inline">\(t \text{ in } t_1, …, t_n\)</span>, n being the number of forecasts, and <span class="math inline">\(F_t\)</span> is the (continuous) predictive cumulative probability distribution at time t. If the true probability distribution of outcomes at time t is <span class="math inline">\(G_t\)</span> then the forecasts <span class="math inline">\(F_t\)</span> are said to be ideal if <span class="math inline">\(F_t = G_t\)</span> at all times <span class="math inline">\(t\)</span>. In that case, the probabilities ut are distributed uniformly.</p>
<p>In the case of discrete outcomes such as incidence counts, the PIT is no longer uniform even when forecasts are ideal. In that case a randomised PIT can be used instead:</p>
<p><span class="math display">\[u_t = P_t(k_t) + v \cdot (P_t(k_t) - P_t(k_t - 1) )\]</span></p>
<p>where <span class="math inline">\(k_t\)</span> is the observed count, <span class="math inline">\(P_t(x)\)</span> is the predictive cumulative probability of observing incidence <span class="math inline">\(k\)</span> at time <span class="math inline">\(t\)</span>, <span class="math inline">\(P_t (-1) = 0\)</span> by definition and <span class="math inline">\(v\)</span> is standard uniform and independent of <span class="math inline">\(k\)</span>. If <span class="math inline">\(P_t\)</span> is the true cumulative probability distribution, then <span class="math inline">\(u_t\)</span> is standard uniform.</p>
<p>The function checks whether integer or continuous forecasts were provided. It then applies the (randomised) probability integral and tests the values <span class="math inline">\(u_t\)</span> for uniformity using the Anderson-Darling test.</p>
<p>As a rule of thumb, there is no evidence to suggest a forecasting model is miscalibrated if the p-value found was greater than a threshold of <span class="math inline">\(p &gt;= 0.1\)</span>, some evidence that it was miscalibrated if <span class="math inline">\(0.01 &lt; p &lt; 0.1\)</span>, and good evidence that it was miscalibrated if <span class="math inline">\(p &lt;= 0.01\)</span>. In this context it should be noted, though, that uniformity of the PIT is a necessary but not sufficient condition of calibration. It should als be noted that the test only works given sufficient samples, otherwise the Null hypothesis will often be rejected outright.</p>
</div>
<div id="continuous-ranked-probability-score-crps" class="section level2">
<h2 class="hasAnchor">
<a href="#continuous-ranked-probability-score-crps" class="anchor"></a>Continuous Ranked Probability Score (CRPS)</h2>
<p>Wrapper around the <code>crps_sample</code> function from the <code>scoringRules</code> package. For more information look at the manuals from the <code>scoringRules</code> package. The function can be used for continuous as well as integer valued forecasts. Smaller values are better.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">true_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="fl">30</span>, lambda <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span>
<span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">30</span>, lambda <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/crps.html">crps</a></span><span class="op">(</span><span class="va">true_values</span>, <span class="va">predictions</span><span class="op">)</span>
<span class="co">#&gt;  [1] 1.680625 0.627950 1.161400 1.225900 1.442350 1.094000 1.082950 1.290275</span>
<span class="co">#&gt;  [9] 1.450650 1.132550 0.652175 3.586900 0.778750 1.321450 1.235525 1.688100</span>
<span class="co">#&gt; [17] 1.718300 1.427450 0.992025 2.588975 1.510525 1.074650 1.502350 8.124650</span>
<span class="co">#&gt; [25] 3.013200 2.086350 1.705650 5.853775 3.323700 9.884825</span></code></pre></div>
</div>
<div id="dawid-sebastiani-score-dss" class="section level2">
<h2 class="hasAnchor">
<a href="#dawid-sebastiani-score-dss" class="anchor"></a>Dawid-Sebastiani Score (DSS)</h2>
<p>Wrapper around the <code>dss_sample</code> function from the <code>scoringRules</code> package. For more information look at the manuals from the <code>scoringRules</code> package. The function can be used for continuous as well as integer valued forecasts. Smaller values are better.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">true_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="fl">30</span>, lambda <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span>
<span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">30</span>, lambda <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/dss.html">dss</a></span><span class="op">(</span><span class="va">true_values</span>, <span class="va">predictions</span><span class="op">)</span>
<span class="co">#&gt;  [1] -0.0304592  0.6179206  4.1391451  1.6825984  2.3421555  2.5419827</span>
<span class="co">#&gt;  [7]  7.2575726  2.5955554  3.9597393  7.1016767  3.5695263  2.8298228</span>
<span class="co">#&gt; [13]  3.0815708  3.6136371  3.8009685  3.6202935  3.0614751  3.0879998</span>
<span class="co">#&gt; [19]  3.4490011  3.8528585  3.5005664  3.9439285  5.7724624  4.6732654</span>
<span class="co">#&gt; [25]  3.5672419  3.4233104  3.3569228  3.5042390  3.6206040  3.7732352</span></code></pre></div>
</div>
<div id="log-score" class="section level2">
<h2 class="hasAnchor">
<a href="#log-score" class="anchor"></a>Log Score</h2>
<p>Wrapper around the <code>log_sample</code> function from the <code>scoringRules</code> package. For more information look at the manuals from the <code>scoringRules</code> package. The function should not be used for integer valued forecasts. While Log Scores are in principle possible for integer valued foreasts they require a kernel density estimate which is not well defined for discrete values. Smaller values are better.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">true_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">30</span>, mean <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span>
<span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">30</span>, mean <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/logs.html">logs</a></span><span class="op">(</span><span class="va">true_values</span>, <span class="va">predictions</span><span class="op">)</span>
<span class="co">#&gt;  [1] 0.9985068 2.1665243 1.1447799 1.3339886 0.9757385 0.9267761 0.9206277</span>
<span class="co">#&gt;  [8] 1.2924550 1.1357047 2.4218568 0.9842437 1.0981879 1.9734514 1.5677778</span>
<span class="co">#&gt; [15] 1.2189531 1.8872719 1.4734390 1.0563887 1.1081017 0.8525284 0.8360180</span>
<span class="co">#&gt; [22] 1.0284970 1.6365222 1.4161096 1.6513692 1.6555764 1.0471652 1.5927692</span>
<span class="co">#&gt; [29] 1.3270921 1.1592881</span></code></pre></div>
</div>
<div id="brier-score" class="section level2">
<h2 class="hasAnchor">
<a href="#brier-score" class="anchor"></a>Brier Score</h2>
<p>The Brier score is a proper score rule that assesses the accuracy of probabilistic binary predictions. The outcomes can be either 0 or 1, the predictions must be a probability that the true outcome will be 1.</p>
<p>The Brier Score is then computed as the mean squared error between the probabilistic prediction and the true outcome.</p>
<p><span class="math display">\[\text{Brier_Score} = \frac{1}{N} \sum_{t = 1}^{n} (\text{prediction}_t - \text{outcome}_t)^2\]</span></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">true_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">30</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">30</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="fu"><a href="../reference/brier_score.html">brier_score</a></span><span class="op">(</span><span class="va">true_values</span>, <span class="va">predictions</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.3587671</span></code></pre></div>
</div>
<div id="interval-score" class="section level2">
<h2 class="hasAnchor">
<a href="#interval-score" class="anchor"></a>Interval Score</h2>
<p>The Interval Score is a Proper Scoring Rule to score quantile predictions, following Gneiting and Raftery (2007). Smaller values are better.</p>
<p>The score is computed as</p>
<p><span class="math display">\[ \text{score} = (\text{upper} - \text{lower}) + \\
\frac{2}{\alpha} \cdot (\text{lower} - \text{true_value}) \cdot 1(\text{true_values} &lt; \text{lower}) + \\
\frac{2}{\alpha} \cdot (\text{true_value} - \text{upper}) \cdot
1(\text{true_value} &gt; \text{upper})\]</span></p>
<p>where <span class="math inline">\(1()\)</span> is the indicator function and <span class="math inline">\(\alpha\)</span> is the decimal value that indicates how much is outside the prediction interval. To improve usability, the user is asked to provide an interval range in percentage terms, i.e. interval_range = 90 (percent) for a 90 percent prediction interval. Correspondingly, the user would have to provide the 5% and 95% quantiles (the corresponding alpha would then be 0.1). No specific distribution is assumed, but the range has to be symmetric (i.e you can’t use the 0.1 quantile as the lower bound and the 0.7 quantile as the upper). Setting <code>weigh = TRUE</code> will weigh the score by <span class="math inline">\(\frac{\alpha}{2}\)</span> such that the Interval Score converges to the CRPS for increasing number of quantiles.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">true_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">30</span>, mean <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span>
<span class="va">interval_range</span> <span class="op">&lt;-</span> <span class="fl">90</span>
<span class="va">alpha</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">100</span> <span class="op">-</span> <span class="va">interval_range</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100</span>
<span class="va">lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">/</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">30</span>, mean <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span>
<span class="va">upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span> <span class="va">alpha</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">30</span>, mean <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/interval_score.html">interval_score</a></span><span class="op">(</span>true_values <span class="op">=</span> <span class="va">true_values</span>,
               lower <span class="op">=</span> <span class="va">lower</span>,
               upper <span class="op">=</span> <span class="va">upper</span>,
               interval_range <span class="op">=</span> <span class="va">interval_range</span><span class="op">)</span>
<span class="co">#&gt;  [1] 0.11741324 0.26950535 0.19989188 0.22511231 0.18688707 0.22769073</span>
<span class="co">#&gt;  [7] 0.26392581 0.22347678 0.19421752 0.26604938 0.16217327 0.20661930</span>
<span class="co">#&gt; [13] 0.14133684 0.11690478 0.15791044 0.27940039 0.13724469 0.11746712</span>
<span class="co">#&gt; [19] 0.12251802 0.25203144 0.14464362 0.17618905 0.04907079 0.20591338</span>
<span class="co">#&gt; [25] 0.18715284 0.21315917 0.03737979 0.31455681 0.03639008 0.09949675</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nikos Bosse, Sam Abbott, Sebastian Funk.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
