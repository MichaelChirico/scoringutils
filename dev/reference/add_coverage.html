<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Adds interval coverage of central prediction intervals,
quantile coverage for predictive quantiles, as well as the deviation between
desired and actual coverage to a data.table. Forecasts should be in a
quantile format (following the input requirements of score()).
Interval coverage
Interval coverage for a given interval range is defined as the proportion of
observations that fall within the corresponding central prediction intervals.
Central prediction intervals are symmetric around the median and and formed
by two quantiles that denote the lower and upper bound. For example, the 50%
central prediction interval is the interval between the 0.25 and 0.75
quantiles of the predictive distribution.
The function add_coverage() computes the coverage per central prediction
interval, so the interval coverage will always be either TRUE
(observed value falls within the interval) or FALSE  (observed value falls
outside the interval). You can summarise the interval coverage values to get
the proportion of observations that fall within the central prediction
intervals.
Quantile coverage
Quantile coverage for a given quantile is defined as the proportion of
observed values that are smaller than the corresponding predictive quantile.
For example, the 0.5 quantile coverage is the proportion of observed values
that are smaller than the 0.5 quantile of the predictive distribution.
Just as above, for a single observation and the quantile of a single
predictive distribution, the value will either be TRUE or FALSE.
Coverage deviation
The coverage deviation is the difference between the desired coverage
(can be either interval or quantile coverage) and the
actual coverage. For example, if the desired coverage is 90% and the actual
coverage is 80%, the coverage deviation is -0.1."><title>Add Coverage Values to Quantile-Based Forecasts — add_coverage • scoringutils</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Add Coverage Values to Quantile-Based Forecasts — add_coverage"><meta property="og:description" content="Adds interval coverage of central prediction intervals,
quantile coverage for predictive quantiles, as well as the deviation between
desired and actual coverage to a data.table. Forecasts should be in a
quantile format (following the input requirements of score()).
Interval coverage
Interval coverage for a given interval range is defined as the proportion of
observations that fall within the corresponding central prediction intervals.
Central prediction intervals are symmetric around the median and and formed
by two quantiles that denote the lower and upper bound. For example, the 50%
central prediction interval is the interval between the 0.25 and 0.75
quantiles of the predictive distribution.
The function add_coverage() computes the coverage per central prediction
interval, so the interval coverage will always be either TRUE
(observed value falls within the interval) or FALSE  (observed value falls
outside the interval). You can summarise the interval coverage values to get
the proportion of observations that fall within the central prediction
intervals.
Quantile coverage
Quantile coverage for a given quantile is defined as the proportion of
observed values that are smaller than the corresponding predictive quantile.
For example, the 0.5 quantile coverage is the proportion of observed values
that are smaller than the 0.5 quantile of the predictive distribution.
Just as above, for a single observation and the quantile of a single
predictive distribution, the value will either be TRUE or FALSE.
Coverage deviation
The coverage deviation is the difference between the desired coverage
(can be either interval or quantile coverage) and the
actual coverage. For example, if the desired coverage is 90% and the actual
coverage is 80%, the coverage deviation is -0.1."><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">scoringutils</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.2.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/scoringutils.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/metric-details.html">Details on the metrics implemented in `scoringutils`</a>
    <a class="dropdown-item" href="../articles/scoring-forecasts-directly.html">Scoring forecasts directly</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/epiforecasts/scoringutils/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Add Coverage Values to Quantile-Based Forecasts</h1>
      <small class="dont-index">Source: <a href="https://github.com/epiforecasts/scoringutils/blob/HEAD/R/add_coverage.R" class="external-link"><code>R/add_coverage.R</code></a></small>
      <div class="d-none name"><code>add_coverage.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Adds interval coverage of central prediction intervals,
quantile coverage for predictive quantiles, as well as the deviation between
desired and actual coverage to a data.table. Forecasts should be in a
quantile format (following the input requirements of <code><a href="score.html">score()</a></code>).</p>
<p><strong>Interval coverage</strong></p>
<p>Interval coverage for a given interval range is defined as the proportion of
observations that fall within the corresponding central prediction intervals.
Central prediction intervals are symmetric around the median and and formed
by two quantiles that denote the lower and upper bound. For example, the 50%
central prediction interval is the interval between the 0.25 and 0.75
quantiles of the predictive distribution.</p>
<p>The function <code>add_coverage()</code> computes the coverage per central prediction
interval, so the interval coverage will always be either <code>TRUE</code>
(observed value falls within the interval) or <code>FALSE</code>  (observed value falls
outside the interval). You can summarise the interval coverage values to get
the proportion of observations that fall within the central prediction
intervals.</p>
<p><strong>Quantile coverage</strong></p>
<p>Quantile coverage for a given quantile is defined as the proportion of
observed values that are smaller than the corresponding predictive quantile.
For example, the 0.5 quantile coverage is the proportion of observed values
that are smaller than the 0.5 quantile of the predictive distribution.
Just as above, for a single observation and the quantile of a single
predictive distribution, the value will either be <code>TRUE</code> or <code>FALSE</code>.</p>
<p><strong>Coverage deviation</strong></p>
<p>The coverage deviation is the difference between the desired coverage
(can be either interval or quantile coverage) and the
actual coverage. For example, if the desired coverage is 90% and the actual
coverage is 80%, the coverage deviation is -0.1.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">add_coverage</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>A data.frame or data.table with predicted and observed values.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>a data.table with the input and columns "interval_coverage",
"interval_coverage_deviation", "quantile_coverage",
"quantile_coverage_deviation" added.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span> <span class="co"># pipe operator</span></span></span>
<span class="r-in"><span><span class="va">example_quantile</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">add_coverage</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Some rows containing NA values may be removed. This is fine if not unexpected.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Forecast type:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "quantile"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Score columns:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "interval_coverage"           "interval_coverage_deviation"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3] "quantile_coverage"           "quantile_coverage_deviation"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Forecast unit:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "location"        "target_end_date" "target_type"     "location_name"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5] "forecast_date"   "model"           "horizon"        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Key: &lt;location, target_end_date, target_type, location_name, forecast_date, model, horizon, interval_range&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        location target_end_date target_type observed location_name</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          &lt;char&gt;          &lt;Date&gt;      &lt;char&gt;    &lt;num&gt;        &lt;char&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1:       DE      2021-01-02       Cases   127300       Germany</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2:       DE      2021-01-02      Deaths     4534       Germany</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3:       DE      2021-01-09       Cases   154922       Germany</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4:       DE      2021-01-09      Deaths     6117       Germany</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5:       DE      2021-01-16       Cases   110183       Germany</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---                                                            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20541:       IT      2021-07-24      Deaths       78         Italy</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20542:       IT      2021-07-24      Deaths       78         Italy</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20543:       IT      2021-07-24      Deaths       78         Italy</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20544:       IT      2021-07-24      Deaths       78         Italy</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20545:       IT      2021-07-24      Deaths       78         Italy</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        forecast_date quantile_level predicted                model horizon</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               &lt;Date&gt;          &lt;num&gt;     &lt;int&gt;               &lt;char&gt;   &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1:          &lt;NA&gt;             NA        NA                 &lt;NA&gt;      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2:          &lt;NA&gt;             NA        NA                 &lt;NA&gt;      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3:          &lt;NA&gt;             NA        NA                 &lt;NA&gt;      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4:          &lt;NA&gt;             NA        NA                 &lt;NA&gt;      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5:          &lt;NA&gt;             NA        NA                 &lt;NA&gt;      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---                                                                    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20541:    2021-07-12          0.950       499 epiforecasts-EpiNow2       2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20542:    2021-07-12          0.025        55 epiforecasts-EpiNow2       2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20543:    2021-07-12          0.975       611 epiforecasts-EpiNow2       2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20544:    2021-07-12          0.010        48 epiforecasts-EpiNow2       2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20545:    2021-07-12          0.990       719 epiforecasts-EpiNow2       2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        interval_range interval_coverage interval_coverage_deviation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 &lt;num&gt;            &lt;lgcl&gt;                       &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1:             NA                NA                          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2:             NA                NA                          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3:             NA                NA                          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4:             NA                NA                          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5:             NA                NA                          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---                                                             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20541:             90              TRUE                        0.10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20542:             95              TRUE                        0.05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20543:             95              TRUE                        0.05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20544:             98              TRUE                        0.02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20545:             98              TRUE                        0.02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        quantile_coverage quantile_coverage_deviation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   &lt;lgcl&gt;                       &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1:                NA                          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2:                NA                          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3:                NA                          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4:                NA                          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5:                NA                          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---                                              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20541:              TRUE                       0.050</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20542:             FALSE                      -0.025</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20543:              TRUE                       0.025</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20544:             FALSE                      -0.010</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20545:              TRUE                       0.010</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://followtheargument.org/" class="external-link">Nikos Bosse</a>, <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Hugo Gruson, Sebastian Funk.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer></div>

  

  

  </body></html>

